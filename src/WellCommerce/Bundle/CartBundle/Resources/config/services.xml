<?xml version="1.0" encoding="UTF-8" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>
        <service id="cart.manager.front" class="WellCommerce\Bundle\CartBundle\Manager\Front\CartManager">
            <argument type="service" id="cart.repository"/>
            <argument type="service" id="cart.factory"/>
            <argument type="service" id="cart.event_dispatcher"/>
            <argument type="service" id="cart_product.repository"/>
            <argument type="service" id="cart_product.factory"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
        </service>

        <service id="cart_totals.calculator" class="WellCommerce\Bundle\CartBundle\Calculator\CartTotalsCalculator">
            <argument type="service" id="currency.converter"/>
        </service>

        <service id="cart.purger" class="WellCommerce\Bundle\CartBundle\Purger\CartPurger">
            <argument type="service" id="service_container"/>
        </service>

        <service id="package.command.purge.carts" class="WellCommerce\Bundle\CartBundle\Command\PurgeCartsCommand">
            <tag name="console.command"/>
        </service>

        <service id="cart.controller.front" class="WellCommerce\Bundle\CartBundle\Controller\Front\CartController">
            <argument type="service" id="cart.manager.front"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
        </service>

        <service id="cart.repository" class="WellCommerce\Bundle\CartBundle\Repository\CartRepository"
                 factory-service="doctrine.orm.entity_manager" factory-method="getRepository">
            <argument>WellCommerceCartBundle:Cart</argument>
        </service>

        <service id="cart_product.repository" class="WellCommerce\Bundle\CartBundle\Repository\CartProductRepository" factory-service="doctrine.orm.entity_manager" factory-method="getRepository">
            <argument>WellCommerceCartBundle:CartProduct</argument>
        </service>

        <service id="cart_product.dataset.query_builder.front" class="WellCommerce\Bundle\CartBundle\DataSet\Front\CartProductDataSetQueryBuilder">
            <argument type="service" id="cart_product.repository"/>
            <argument type="service" id="cart.provider"/>
        </service>

        <service id="cart_product.dataset.loader.front" class="%dataset.loader.class%">
            <argument type="service" id="cart_product.dataset.query_builder.front"/>
            <argument type="service" id="dataset.processor"/>
        </service>

        <service id="cart_product.dataset.front" class="WellCommerce\Bundle\CartBundle\DataSet\Front\CartProductDataSet">
            <argument key="identifier">cart_product</argument>
            <argument type="service" id="cart_product.dataset.loader.front"/>
            <argument type="service" id="cart_product.event_dispatcher"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
            <configurator service="dataset.configurator" method="configure"/>
        </service>

        <service id="cart_product.collection.front" parent="dataset.collection_builder.factory">
            <argument type="service" id="cart_product.dataset.front"/>
        </service>

        <service id="cart.form_builder" class="WellCommerce\Bundle\CartBundle\Form\Front\CartFormBuilder">
            <argument type="service" id="form.resolver.factory"/>
            <argument type="service" id="form.handler"/>
            <argument type="service" id="cart_product.event_dispatcher"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
        </service>

        <service id="cart_product.provider" class="WellCommerce\Bundle\CartBundle\Provider\CartProductProvider">
            <call method="setCollectionBuilder">
                <argument type="service" id="cart_product.collection.front"/>
            </call>
            <tag name="resource.provider" alias="cart_product"/>
        </service>

        <service id="cart.provider" class="WellCommerce\Bundle\CartBundle\Provider\CartProvider">
            <tag name="resource.provider" alias="cart"/>
        </service>

        <service id="cart_summary.provider" class="WellCommerce\Bundle\CartBundle\Provider\CartSummaryProvider">
            <argument type="service" id="currency.converter"/>
            <argument type="service" id="shipping_method.calculator.collection"/>
            <tag name="resource.provider" alias="cart_summary"/>
        </service>

        <service id="twig.extension.cart" class="WellCommerce\Bundle\CartBundle\Twig\Extension\CartExtension">
            <argument type="service" id="cart.provider"/>
            <argument type="service" id="cart_product.provider"/>
            <tag name="twig.extension"/>
        </service>

        <service id="cart.factory" class="WellCommerce\Bundle\CartBundle\Factory\CartFactory">
            <argument type="service" id="payment_method.repository"/>
            <argument type="service" id="shipping_method.repository"/>
        </service>

        <service id="cart.event_dispatcher" class="WellCommerce\Bundle\CartBundle\EventDispatcher\CartEventDispatcher">
            <argument type="service" id="event_dispatcher" />
        </service>

        <service id="cart_product.factory" class="WellCommerce\Bundle\CartBundle\Factory\CartProductFactory" />

        <service id="cart_product.event_dispatcher" class="WellCommerce\Bundle\CartBundle\EventDispatcher\CartProductEventDispatcher">
            <argument type="service" id="event_dispatcher" />
        </service>

        <service id="cart.subscriber" class="WellCommerce\Bundle\CartBundle\EventListener\CartSubscriber">
            <argument type="service" id="cart.manager.front"/>
            <argument type="service" id="cart_totals.calculator"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="cart_product.request_param_converter" class="WellCommerce\Bundle\CartBundle\Request\ParamConverter\CartProductParamConverter">
            <argument type="service" id="cart_product.repository" />
            <tag name="request.param_converter" converter="cart_product" priority="10"/>
        </service>
    </services>
</container>
