<?xml version="1.0" encoding="UTF-8" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <imports>
        <import resource="admin/order.xml"/>
        <import resource="front/order.xml"/>
    </imports>

    <services>
        <service id="order.modifier.collection" class="Doctrine\Common\Collections\ArrayCollection" shared="false" />

        <service id="order.modifier.provider" class="WellCommerce\Bundle\OrderBundle\Provider\OrderModifierProvider">
            <argument type="service" id="order.modifier.collection"/>
        </service>

        <service id="order.visitor.collection" class="Doctrine\Common\Collections\ArrayCollection" shared="false" />

        <service id="order.visitor.traverser" class="WellCommerce\Bundle\OrderBundle\Visitor\OrderVisitorTraverser">
            <argument type="service" id="order.visitor.collection"/>
        </service>

        <service id="order_product.order.visitor" class="WellCommerce\Bundle\OrderBundle\Visitor\OrderProductVisitor">
            <argument type="service" id="currency.helper"/>
            <argument type="service" id="variant.helper"/>
            <argument type="service" id="price.factory"/>
            <tag name="order.visitor" alias="order_product"/>
        </service>

        <service id="product_total.order.visitor" class="WellCommerce\Bundle\OrderBundle\Visitor\OrderProductTotalVisitor">
            <argument type="service" id="currency.helper"/>
            <tag name="order.visitor" alias="product_total"/>
        </service>

        <service id="summary.order.visitor" class="WellCommerce\Bundle\OrderBundle\Visitor\OrderSummaryVisitor">
            <argument type="service" id="currency.helper"/>
            <argument type="service" id="order_summary.factory"/>
            <tag name="order.visitor" alias="summary"/>
        </service>

        <service id="order.subscriber" class="WellCommerce\Bundle\OrderBundle\EventListener\OrderSubscriber">
            <argument type="service" id="request.helper"/>
            <argument type="service" id="security.helper"/>
            <argument type="service" id="order.manager"/>
            <argument type="service" id="order.storage"/>
            <argument type="service" id="shop.storage"/>
            <argument type="service" id="order.visitor.traverser"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="order.dataset.transformer.order_client" class="WellCommerce\Bundle\OrderBundle\DataSet\Transformer\ClientTransformer">
            <tag name="dataset.transformer" alias="order_client"/>
        </service>

        <service id="order.storage" class="WellCommerce\Bundle\OrderBundle\Storage\OrderStorage"/>

        <service id="order_product.request_param_converter" class="WellCommerce\Bundle\OrderBundle\Request\ParamConverter\OrderProductParamConverter">
            <argument type="service" id="order_product.repository" />
            <argument>id</argument>
            <argument type="collection">
                <argument>WellCommerce\Bundle\OrderBundle\Entity\OrderProduct</argument>
                <argument>WellCommerce\Bundle\OrderBundle\Entity\OrderProductInterface</argument>
            </argument>
            <tag name="request.param_converter" converter="cart_product" priority="10"/>
        </service>

        <service id="twig.extension.order" class="WellCommerce\Bundle\OrderBundle\Twig\Extension\OrderExtension">
            <argument type="service" id="order.storage"/>
            <argument type="service" id="order_product.dataset.front"/>
            <tag name="twig.extension"/>
        </service>
    </services>
</container>
